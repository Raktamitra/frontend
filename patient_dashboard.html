<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Patient Dashboard | RaktaMitra</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  ></script>
  <!-- Leaflet Control Geocoder -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css"
  />
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
  <style>
    body {
      background: url('pictures/patient.png') no-repeat center center fixed;
      background-size: cover;
    }

    .active-btn {
      background-color: #fecaca;
      color: #7f1d1d;
    }

    .loading-spinner {
      display: inline-block;
      width: 1.5rem;
      height: 1.5rem;
      border: 0.25rem solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .toast {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 1rem;
      border-radius: 0.5rem;
      color: white;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      transform: translateX(200%);
      transition: transform 0.3s ease-in-out;
    }

    .toast.show {
      transform: translateX(0);
    }

    .toast.success {
      background-color: #10b981;
    }

    .toast.error {
      background-color: #ef4444;
    }

    .toast.warning {
      background-color: #f59e0b;
    }

    .btn-accept {
      background-color: #10b981;
      color: white;
    }

    .btn-reject {
      background-color: #ef4444;
      color: white;
    }

    .btn-accept:hover {
      background-color: #059669;
    }

    .btn-reject:hover {
      background-color: #dc2626;
    }
  </style>
</head>

<body class="min-h-screen flex bg-white bg-opacity-70">
  <!-- Toast Notification -->
  <div id="toast" class="toast hidden"></div>

  <!-- Sidebar -->
  <aside class="w-56 bg-red-600 text-white p-6 flex flex-col space-y-4 min-h-screen sticky top-0">
    <div class="flex items-center space-x-3 mb-8">
      <img src="logo.png" alt="Logo" class="h-10 w-10 rounded-full" />
      <span class="text-xl font-bold">RaktaMitra</span>
    </div>
    <button onclick="showSection('profile', this)" class="px-4 py-2 rounded hover:bg-red-400 transition flex items-center space-x-2">
      <i class="fas fa-user"></i>
      <span>Profile</span>
    </button>
    <button onclick="showSection('form', this)" class="px-4 py-2 rounded hover:bg-red-400 transition flex items-center space-x-2">
      <i class="fas fa-tint"></i>
      <span>Blood Request</span>
    </button>
    <button onclick="showSection('history', this)" class="px-4 py-2 rounded hover:bg-red-400 transition flex items-center space-x-2">
      <i class="fas fa-history"></i>
      <span>Request History</span>
    </button>
    <button onclick="showSection('accepted', this)" class="px-4 py-2 rounded hover:bg-red-400 transition flex items-center space-x-2">
      <i class="fas fa-check-circle"></i>
      <span>Accepted requests</span>
    </button>
    <div class="mt-auto">
      <button onclick="logout()" class="px-4 py-2 rounded hover:bg-red-400 transition w-full flex items-center space-x-2">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
      </button>
    </div>
  </aside>

  <!-- Content -->
  <main class="flex-1 p-6 overflow-y-auto">
    <!-- Loading Indicator -->
    <div id="loading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white p-6 rounded-lg shadow-lg text-center">
        <div class="loading-spinner mx-auto mb-4"></div>
        <p class="text-gray-700">Loading...</p>
      </div>
    </div>

    <!-- Patient Profile -->
    <section id="profile" class="hidden max-w-xl mx-auto bg-orange-100 p-6 rounded-lg shadow">
      <h2 class="text-2xl font-semibold mb-4 text-red-700 flex items-center space-x-2">
        <i class="fas fa-user-circle"></i>
        <span>Patient Profile</span>
      </h2>
      <div class="flex flex-col md:flex-row gap-6">
        <div class="flex flex-col items-center">
          <img src="https://cdn.pixabay.com/photo/2023/02/18/11/00/icon-7797704_1280.png" alt="Patient" class="w-32 h-32 rounded-full border-4 border-red-500 mb-4" />
          <button id="changePhotoBtn" class="text-sm text-red-600 hover:text-red-800">
            <i class="fas fa-camera mr-1"></i>Change Photo
          </button>
        </div>
        <form id="profileForm" class="space-y-4 text-left flex-1">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="profileName" class="block text-sm font-semibold text-red-900">Full Name</label>
              <input id="profileName" type="text" class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" required />
            </div>

            <div>
              <label for="profileEmail" class="block text-sm font-semibold text-red-900">Email</label>
              <input id="profileEmail" type="email" class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" required />
            </div>

            <div>
              <label for="profilePhone" class="block text-sm font-semibold text-red-900">Phone Number</label>
              <input id="profilePhone" type="tel" class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" disabled required />
            </div>

            <div>
              <label for="profileAge" class="block text-sm font-semibold text-red-900">Age</label>
              <input id="profileAge" type="number" class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" required min="0" />
            </div>

            <div>
              <label for="profileGender" class="block text-sm font-semibold text-red-900">Gender</label>
              <select id="profileGender" class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" required>
                <option value="">Select Gender</option>
                <option value="MALE">Male</option>
                <option value="FEMALE">Female</option>
                <option value="OTHER">Other</option>
              </select>
            </div>

            <div>
              <label for="profileBlood" class="block text-sm font-semibold text-red-900">Blood Group</label>
              <select id="profileBlood" class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" required>
                <option value="">Select Blood Group</option>
                <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
              </select>
            </div>

            <div>
              <label for="profileDOB" class="block text-sm font-semibold text-red-900">Date of Birth</label>
              <input id="profileDOB" type="date" class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" required />
            </div>
          </div>

          <div>
            <label for="profileAddress" class="block text-sm font-semibold text-red-900">Address</label>
            <textarea id="profileAddress" rows="2" class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" required></textarea>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label for="profileCity" class="block text-sm font-semibold text-red-900">City</label>
              <select id="profileCity" class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" required>
                <option value="" selected disabled>Select City</option>
                <option value="Bengaluru">Bengaluru</option>
                <option value="Hyderabad">Hyderabad</option>
                <option value="Chennai">Chennai</option>
                <option value="Nellore">Nellore</option>
                <option value="Tirupati">Tirupati</option>
                <option value="Vizag">Vizag</option>
                <option value="Kakinada">Kakinada</option>
                <option value="Vijayawada">Vijayawada</option>
                <option value="Guntur">Guntur</option>
              </select>
            </div>

            <div>
              <label for="profileState" class="block text-sm font-semibold text-red-900">State</label>
              <select id="profileState" class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" required>
                <option value="" selected>Select State</option>
                <option value="Andhra Pradesh">Andhra Pradesh</option>
                <option value="Karnataka">Karnataka</option>
                <option value="Tamil Nadu">Tamil Nadu</option>
                <option value="Telangana">Telangana</option>
              </select>
            </div>

            <div>
              <label for="profilePincode" class="block text-sm font-semibold text-red-900">Pincode</label>
              <input id="profilePincode" type="text" class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" required pattern="\d{5,6}" />
            </div>
          </div>

          <div class="flex justify-end space-x-4 pt-4">
            <button type="reset" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition">
              <i class="fas fa-undo mr-2"></i>Reset
            </button>
            <button type="button" id="update-profile-btn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition flex items-center">
              <span id="update-text">Save Profile</span>
              <span id="update-spinner" class="loading-spinner ml-2 hidden"></span>
            </button>
          </div>
        </form>
      </div>
    </section>

    <!-- Blood Request Form -->
    <section id="form" class="hidden max-w-xl mx-auto bg-orange-100 p-6 rounded-lg shadow">
      <h2 class="text-2xl font-semibold mb-4 text-red-700 flex items-center space-x-2">
        <i class="fas fa-tint"></i>
        <span>Blood Request Form</span>
      </h2>
      <form id="requestForm" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block font-medium text-red-900">Blood Group</label>
            <select name="bloodGroup" class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" required>
              <option value="">Select Blood Group</option>
              <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
              <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
            </select>
          </div>

          <div>
            <label class="block font-medium text-red-900">Units Needed</label>
            <input type="number" name="unitsNeeded" placeholder="Units Needed" 
                   class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" 
                   min="1" max="10" required />
          </div>
        </div>

        <div>
          <label class="block font-medium text-red-900">Hospital Name</label>
          <input type="text" name="hospitalName" placeholder="Hospital Name" 
                 class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" required />
        </div>

        <div>
          <label class="block font-medium text-red-900">Hospital Contact</label>
          <input type="tel" name="hospitalContact" placeholder="Hospital Contact Number" 
                 class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" required />
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block font-medium text-red-900">Pick Location</label>
            <div id="map" class="w-full h-64 rounded border mb-2"></div>
            <input type="hidden" name="latitude" id="latitude" />
            <input type="hidden" name="longitude" id="longitude" />
            <p class="text-sm text-gray-600 mt-1">Click on the map to select your hospital location.</p>
            <p class="text-sm text-red-600 mt-2 font-semibold">
              Blood donation services currently available in: 
              Bengaluru, Hyderabad, Chennai, Nellore, Tirupati, Vizag, Kakinada, Vijayawada, Guntur
            </p>
            <p class="text-xs text-gray-500 mt-1">
              We're working to expand our network to serve more locations soon.
            </p>
          </div>

          <div>
            <label class="block font-medium text-red-900">Urgency</label>
            <select name="urgency" class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500" required>
              <option value="">Select Urgency</option>
              <option value="High">High (Within 24 hours)</option>
              <option value="Medium">Medium (Within 3 days)</option>
              <option value="Low">Low (Within a week)</option>
            </select>
          </div>
        </div>

        <div>
          <label class="block font-medium text-red-900">Additional Notes</label>
          <textarea name="notes" rows="2" placeholder="Any special requirements or notes" 
                    class="w-full p-2 border rounded focus:ring-2 focus:ring-red-500"></textarea>
        </div>

        <div class="flex justify-end pt-2">
          <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 transition flex items-center">
            <span id="submit-text">Submit Request</span>
            <span id="submit-spinner" class="loading-spinner ml-2 hidden"></span>
          </button>
        </div>
      </form>
    </section>

    <!-- Request History -->
    <section id="history" class="hidden max-w-4xl mx-auto bg-orange-50 p-6 rounded-lg shadow">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-semibold text-red-700 flex items-center space-x-2">
          <i class="fas fa-history"></i>
          <span>Request History</span>
        </h2>
        <button id="refresh-history" class="text-red-600 hover:text-red-800">
          <i class="fas fa-sync-alt"></i> Refresh
        </button>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full table-auto border-collapse">
          <thead>
            <tr class="bg-green-200">
              <th class="border p-2">Request ID</th>
              <th class="border p-2">Date</th>
              <th class="border p-2">Blood Group</th>
              <th class="border p-2">Units</th>
              <th class="border p-2">Hospital</th>
              <th class="border p-2">Status</th>
              <th class="border p-2">Actions</th>
            </tr>
          </thead>
          <tbody id="historyTable">
            <tr>
              <td colspan="7" class="text-center p-4">Loading request history...</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div id="pagination" class="flex justify-between items-center mt-4">
        <button id="prev-page" class="px-4 py-2 bg-gray-200 rounded disabled:opacity-50">
          <i class="fas fa-chevron-left"></i> Previous
        </button>
        <span id="page-info">Page 1 of 1</span>
        <button id="next-page" class="px-4 py-2 bg-gray-200 rounded disabled:opacity-50">
          Next <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </section>

    <!-- Accepted Requests Section -->
    <section id="accepted" class="hidden max-w-4xl mx-auto bg-orange-50 p-6 rounded-lg shadow">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-semibold text-red-700 flex items-center space-x-2">
          <i class="fas fa-check-circle"></i>
          <span>Accepted Requests</span>
        </h2>
        <button id="refresh-accepted" class="text-red-600 hover:text-red-800">
          <i class="fas fa-sync-alt"></i> Refresh
        </button>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full table-auto border-collapse">
          <thead>
            <tr class="bg-green-200">
              <th class="border p-2">Request ID</th>
              <th class="border p-2">Donor Name</th>
              <th class="border p-2">Donor Contact</th>
              <th class="border p-2">Blood Group</th>
              <th class="border p-2">Units</th>
              <th class="border p-2">Hospital</th>
              <th class="border p-2">Status</th>
              <th class="border p-2">Actions</th>
            </tr>
          </thead>
          <tbody id="acceptedTable">
            <tr>
              <td colspan="8" class="text-center p-4">Loading accepted requests...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <script src="./js/patient_dashboard.js"></script>
  <script>
    // Simple section switcher
    function showSection(sectionId, button) {
      // Hide all sections
      document.querySelectorAll('main section').forEach(section => {
        section.classList.add('hidden');
      });
      
      // Show selected section
      document.getElementById(sectionId).classList.remove('hidden');
      
      // Update active button styling
      document.querySelectorAll('aside button').forEach(btn => {
        btn.classList.remove('active-btn');
      });
      if (button) button.classList.add('active-btn');
    }
    
    // Show profile by default
    document.addEventListener('DOMContentLoaded', () => {
      showSection('profile');
    });
    
    function logout() {
      localStorage.removeItem('token');
      window.location.href = 'login.html';
    }
  </script>
</body>
</html>